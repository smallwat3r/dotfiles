#!/usr/bin/env bash
#
# launcher-window - Navigate to open windows in Sway
#
# Interactively select from all open windows and focus the selected one.
# Window titles often include browser tab names, making this useful for
# tab navigation as well.
#
# Dependencies: fzf, swaymsg, jq
#
set -euo pipefail

. "${HOME}/.local/lib/launcher.sh"

require fzf swaymsg jq

fzf_pick_window() {
    fzf --reverse --delimiter=$'\t' --with-nth=2.. \
        --bind="$FZF_BIND" --color="$FZF_COLORS"
}

list_windows() {
    swaymsg -t get_tree | jq -r '
        recurse(.nodes[]?, .floating_nodes[]?)
        | select(.type == "con" and .name != null and .name != "")
        | "\(.id)\t\(.app_id // .window_properties.class // "unknown"): \(.name)"
    '
}

selected="$(list_windows | fzf_pick_window)" || exit 0
[[ -z "$selected" ]] && exit 0

con_id="${selected%%$'\t'*}"
swaymsg "[con_id=$con_id] focus"
