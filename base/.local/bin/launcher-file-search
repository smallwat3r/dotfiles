#!/usr/bin/env bash
#
# launcher-file-search - Search and open files from home directory
#
# Dependencies: fzf, rg (ripgrep), ec (emacsclient wrapper)
#
set -euo pipefail

. "${HOME}/.local/lib/launcher.sh"

require fzf rg

EXCLUDES='--glob "!.git/*" --glob "!*.pyc" --glob "!.npm/*" --glob "!.cache/*"'

if is_macos; then
    EXCLUDES+=' --glob "!Library/*" --glob "!Movies/*"'
else
    EXCLUDES+=' --glob "!.local/share/*" --glob "!snap/*"'
fi

cd "$HOME" || exit 1

target=$(
    FZF_DEFAULT_COMMAND="rg --files --hidden $EXCLUDES" \
    fzf --reverse --wrap --highlight-line --bind="$FZF_BIND" --color="$FZF_COLORS"
) || exit 0

[[ -n $target ]] && setsid -f ec "$HOME/$target"
