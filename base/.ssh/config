# Include host-specific configs
Include ~/.ssh/private
Include ~/.ssh/work

# Global defaults
Host *
  # Ignore macOS-specific options on Linux
  IgnoreUnknown AddKeysToAgent,UseKeychain
  UseKeychain yes
  AddKeysToAgent yes
  IdentityFile ~/.ssh/id_yubikey
  IdentityFile ~/.ssh/id_rsa
  PreferredAuthentications publickey
  # Keep connections alive
  ServerAliveInterval 60
  ServerAliveCountMax 3
  # Keep known_hosts readable for debugging
  HashKnownHosts no
  # Reuse connections: first connection becomes master, subsequent ones multiplex
  ControlMaster auto
  # Socket path for multiplexed connections (%r=user, %h=host, %p=port)
  ControlPath ~/.ssh/sockets/%r@%h-%p
  # Keep master connection alive for 10 minutes after last session closes
  ControlPersist 600

# GitHub
Host github.com
  User git

# Local network devices (mDNS)
Host pihole nas retropie gardener
  User pi
  Hostname %h.local

# Tailscale hosts
Host retropie.ts
  Hostname retropie.feist-corn.ts.net

Host pihole.ts
  Hostname pihole.feist-corn.ts.net

Host nas.ts
  Hostname nas.feist-corn.ts.net

Host gardener.ts
  Hostname gardener.feist-corn.ts.net

Host pihole.ts nas.ts gardener.ts retropie.ts
  User pi

# Local machines
Host robot
  User smallwat3r
  Hostname robot.local

# Local VMs (port-forwarded)
Host vm.ubuntu20 vm.ubuntu22
  User smallwat3r
  Hostname 127.0.0.1

Host vm.ubuntu20
  Port 3022

Host vm.ubuntu22
  Port 3122

# Balena device tunnel
Host balena-tunnel
  User root
  Hostname localhost
  Port 22222
