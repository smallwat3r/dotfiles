#!/usr/bin/env bash
# Configure macOS system preferences.
# Run once after a fresh install or to reset preferences.
set -euo pipefail

[[ $OSTYPE == darwin* ]] || { echo "macOS only" >&2; exit 1; }

# Appearance
defaults write NSGlobalDomain AppleHighlightColor -string '0.752941 0.964706 0.678431'
defaults write NSGlobalDomain AppleInterfaceStyle -string 'Light'

# Font smoothing (0=none, 3=max)
defaults -currentHost write -g AppleFontSmoothing -int 1
defaults write org.gnu.Emacs AppleFontSmoothing -int 1

# Always show window proxy icons
defaults write -g NSToolbarTitleViewRolloverDelay -float 0

# Finder
defaults write com.apple.finder AppleShowAllFiles -bool true
defaults write com.apple.finder ShowStatusBar -bool true
defaults write com.apple.finder ShowPathbar -bool true
defaults write com.apple.finder _FXShowPosixPathInTitle -bool true
defaults write com.apple.finder FXEnableExtensionChangeWarning -bool false
defaults write com.apple.Finder FXPreferredViewStyle Nlsv
defaults write NSGlobalDomain AppleShowAllExtensions -bool true

# Dock
defaults write com.apple.dock show-recents -bool false
defaults write com.apple.dock autohide -bool true
defaults write com.apple.dock autohide-delay -float 0.0001
defaults write com.apple.dock tilesize -int 25
defaults write com.apple.Dock appswitcher-all-displays -bool true

# Keyboard
defaults write -g InitialKeyRepeat -int 9
defaults write -g KeyRepeat -int 1
defaults write NSGlobalDomain ApplePressAndHoldEnabled -bool false

# Disable auto-correct and substitution
defaults write NSGlobalDomain NSAutomaticSpellingCorrectionEnabled -bool false
defaults write NSGlobalDomain NSAutomaticCapitalizationEnabled -bool false
defaults write NSGlobalDomain NSAutomaticPeriodSubstitutionEnabled -bool false

# Disable system sounds
defaults write NSGlobalDomain com.apple.sound.beep.volume -int 0
defaults write NSGlobalDomain com.apple.sound.uiaudio.enabled -int 0

# Disable conflicting keyboard shortcuts
defaults write NSGlobalDomain NSUserKeyEquivalents -dict-add 'Mission Control' nil
defaults write NSGlobalDomain NSUserKeyEquivalents -dict-add 'Application windows' nil
defaults write NSGlobalDomain NSUserKeyEquivalents -dict-add 'Move left a space' nil
defaults write NSGlobalDomain NSUserKeyEquivalents -dict-add 'Move right a space' nil

# Animations
defaults write NSGlobalDomain NSAutomaticWindowAnimationsEnabled -bool false
defaults write NSGlobalDomain NSWindowResizeTime -float 0.001

# Misc
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true

# Activity Monitor
defaults write com.apple.ActivityMonitor IconType -int 5
defaults write com.apple.ActivityMonitor ShowCategory -int 0
defaults write com.apple.ActivityMonitor SortColumn -string 'CPUUsage'
defaults write com.apple.ActivityMonitor SortDirection -int 0

killall Dock

echo "Done. Some changes require logout/restart."
