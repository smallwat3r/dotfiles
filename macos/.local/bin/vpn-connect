#!/usr/bin/env osascript
-- Connect to a VPN using Tunnelblick.
-- Usage: vpn-connect <config-name>

on run argv
  if (count of argv) is 0 then
    return "Usage: vpn-connect <config-name>"
  end if

  set configName to item 1 of argv

  tell application "Tunnelblick"
    try
      connect configName
      repeat
        set currentState to state of first configuration where name = configName
        if currentState = "CONNECTED" then exit repeat
        delay 1
      end repeat
      return "Connected to " & configName
    on error
      return "Error: VPN config '" & configName & "' not found"
    end try
  end tell
end run
