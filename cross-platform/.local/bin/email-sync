#!/usr/bin/env bash
#
# Syncing emails with mbsync and notmuch
#
# Can be triggerd every minute by a cron job with:
#   */1 * * * * /usr/local/bin/email-sync >/tmp/email-sync-cron-stdout.log 2>/tmp/email-sync-cron-stderr.log

# kill any running mbsync processes quietly
pkill -x mbsync 2>/dev/null

# run full sync, exit early on failure
if ! mbsync -a; then
  echo "mbsync failed" >&2
  exit 1
fi

# update notmuch db
notmuch new
