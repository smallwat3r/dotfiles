#!/usr/bin/env bash
# Open file(s) in emacsclient.
# Creates a new frame if none exists, otherwise reuses the current frame.
# Usage: ec [file...]
set -euo pipefail

# Start daemon if not running and wait for it to be ready
if ! emacsclient -e '(progn)' &>/dev/null; then
  emacs --daemon &>/dev/null || true
  while ! emacsclient -e '(progn)' &>/dev/null; do
    sleep 0.1
  done
fi

has_frame=$(emacsclient -e '(> (length (frame-list)) 1)' 2>/dev/null || true)
if [[ "$has_frame" == "t" ]]; then
  emacsclient -n "$@"
else
  emacsclient -n -c "$@"
fi
